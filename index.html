<script>
  const terminal = document.getElementById("terminal");
  const cmdInput = document.getElementById("cmd");

  const asciiArt = `  
    /\\      __  __      __      _   _    _
   /  \\    |  \\/  |    /  \\    | \\ | |  | |
  / /\\ \\   | \\  / |   / /\\ \\   |  \\| |  | |
 / ____ \\  | |\\/| |  / ____ \\  |   \` |  | |
/_/    \\_\\ | |  | | /_/    \\_\\ |_| \\_|  |_|`;

  // Commands
  const commands = {
    help: `Available commands:\n  help                    | To see all the commands\n  ls                      | To find all the directories\n  cd [directory]          | To navigate into a directory e.g. cd PastExperiences\n  whoami                  | Try and see`,
    ls: `Directories:\n  AboutMe\n  Education\n  PastExperiences\n  Resume\n  Projects\n  FunStuff`,
    cd: (arg) => {
      const validDirs = {
        aboutme: "about.html",
        education: "education.html",
        pastexperiences: "experience.html",
        resume: "resume.html",
        projects: "projects.html",
        funstuff: "fun.html"
      };
      const page = validDirs[arg.toLowerCase()];
      if (page) {
        saveTerminalHistory(`$ cd ${arg}\nRedirecting to ${arg}...`);
        window.location.href = page;
        return `Redirecting to ${arg}...`;
      } else {
        return `cd: ${arg}: No such directory`;
      }
    },
    whoami: () => `Amani Agrawal\nCS + Math undergrad @ NYU 2027`,
    motto: () => `"Code. Build. Repeat."`,
    clear: () => {
      terminal.innerHTML = "";
      localStorage.setItem("terminalHistory", "");
      return "";
    }
  };

  // Save new command output to localStorage
  function saveTerminalHistory(entry) {
    const currentHistory = localStorage.getItem("terminalHistory") || "";
    const updatedHistory = `${currentHistory}\n${entry}`;
    localStorage.setItem("terminalHistory", updatedHistory);
  }

  // Load saved history (if exists)
  function loadTerminalHistory() {
    const saved = localStorage.getItem("terminalHistory");
    if (saved) {
      terminal.innerHTML = asciiArt + "\n" + saved;
    } else {
      terminal.innerHTML = `${asciiArt}\nWelcome to Amani's Terminal Portfolio. Type 'help' to see all the commands.`;
    }
  }

  function processCommand(input) {
    const args = input.trim().split(" ");
    const command = args[0].toLowerCase();

    let output = "";
    if (command === "cd") {
      if (args[1] === "..") {
        output = "You're already at the root. No going back ðŸ‘»";
      } else {
        output = commands.cd(args[1] || "");
      }
    } else if (commands[command]) {
      output = typeof commands[command] === "function"
        ? commands[command]() : commands[command];
    } else {
      output = `${command}: command not found`;
    }

    if (command !== "clear") {
      const formatted = `\n$ ${input}\n${output}`;
      terminal.innerHTML += formatted;
      saveTerminalHistory(formatted);
    } else {
      output && (terminal.innerHTML += `\n$ ${input}`);
    }

    window.scrollTo(0, document.body.scrollHeight);
  }

  cmdInput.addEventListener("keydown", (e) => {
    if (e.key === "Enter") {
      const input = cmdInput.value;
      cmdInput.value = "";
      processCommand(input);
    }
  });

  // Load saved terminal state
  loadTerminalHistory();
</script>
